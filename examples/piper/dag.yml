nodes:
  $for(params.flags):
    ## GENERATE SAMPLES
    generator_$index:
      command: pipelime datasets generate_toy_dataset
      outputs:
        output_folder: $var(params.output_folder)/generated_$item
      args:
        size: $var(params.size)

    ## SUBSAMPLE EACH DATASET
    subsample_$index:
      command: pipelime underfolder subsample
      inputs:
        input_folder: $var(params.output_folder)/generated_$item
      outputs:
        output_folder: $var(params.output_folder)/subsampled_$item
      args:
        factor: 0.5

    ## EXECUTE CUSTOM NODE ON EACH DATASET
    detection_$index:
      command: $var(params.custom_command)
      inputs:
        input_folder: $var(params.output_folder)/subsampled_$item
      outputs:
        output_folder: $var(params.output_folder)/detected_$item
      args:
        fake_time: 0.01
      outputs_schema:
        output_folder: $var(params.schemas.detected)

  ## SUM UP RESULTS
  summation:
    command: pipelime underfolder sum
    inputs:
      input_folders:
        $for(params.flags):
          - $var(params.output_folder)/detected_$item
    outputs:
      output_folder: $var(params.output_folder)/summed
